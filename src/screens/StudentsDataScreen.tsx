import React, { useState } from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  StyleSheet,
  ScrollView,
  SafeAreaView,
  TextInput,
  Alert,
} from 'react-native';

interface StudentsDataScreenProps {
  onBack?: () => void;
}

const StudentsDataScreen: React.FC<StudentsDataScreenProps> = ({ onBack }) => {
  const [searchText, setSearchText] = useState('');
  const [filterStatus, setFilterStatus] = useState('all'); // all, uploaded, not-uploaded

  // Sample students data
  const studentsData = [
    {
      id: '1',
      name: 'рдЕрдорди рд╢рд░реНрдорд╛',
      rollNumber: 'R001',
      udiseCode: 'UD001',
      pedStatus: 'uploaded',
      certificateStatus: 'generated',
      uploadDate: '2024-12-15',
    },
    {
      id: '2',
      name: 'рдкреНрд░рд┐рдпрд╛ рдЧреБрдкреНрддрд╛',
      rollNumber: 'R002',
      udiseCode: 'UD002',
      pedStatus: 'uploaded',
      certificateStatus: 'generated',
      uploadDate: '2024-12-14',
    },
    {
      id: '3',
      name: 'рд░рд╛рд╣реБрд▓ рд╡рд░реНрдорд╛',
      rollNumber: 'R003',
      udiseCode: 'UD003',
      pedStatus: 'uploaded',
      certificateStatus: 'not-generated',
      uploadDate: '2024-12-13',
    },
    {
      id: '4',
      name: 'рдЕрдиреАрддрд╛ рджреЗрд╡реА',
      rollNumber: 'R004',
      udiseCode: 'UD004',
      pedStatus: 'not-uploaded',
      certificateStatus: 'not-generated',
      uploadDate: null,
    },
    {
      id: '5',
      name: 'рд╡рд┐рдХрд╛рд╕ рдХреБрдорд╛рд░',
      rollNumber: 'R005',
      udiseCode: 'UD005',
      pedStatus: 'uploaded',
      certificateStatus: 'generated',
      uploadDate: '2024-12-11',
    },
    {
      id: '6',
      name: 'рд╕реБрдиреАрддрд╛ рд░рд╛рдп',
      rollNumber: 'R006',
      udiseCode: 'UD006',
      pedStatus: 'not-uploaded',
      certificateStatus: 'not-generated',
      uploadDate: null,
    },
    {
      id: '7',
      name: 'рдЕрдЬрдп рд╕рд┐рдВрд╣',
      rollNumber: 'R007',
      udiseCode: 'UD007',
      pedStatus: 'uploaded',
      certificateStatus: 'generated',
      uploadDate: '2024-12-10',
    },
    {
      id: '8',
      name: 'рдкреВрдЬрд╛ рдорд┐рд╢реНрд░рд╛',
      rollNumber: 'R008',
      udiseCode: 'UD008',
      pedStatus: 'not-uploaded',
      certificateStatus: 'not-generated',
      uploadDate: null,
    },
    {
      id: '9',
      name: 'рд░реЛрд╣рд┐рдд рдкрдЯреЗрд▓',
      rollNumber: 'R009',
      udiseCode: 'UD009',
      pedStatus: 'uploaded',
      certificateStatus: 'not-generated',
      uploadDate: '2024-12-09',
    },
    {
      id: '10',
      name: 'рдорд╛рдпрд╛ рд╢реБрдХреНрд▓рд╛',
      rollNumber: 'R010',
      udiseCode: 'UD010',
      pedStatus: 'not-uploaded',
      certificateStatus: 'not-generated',
      uploadDate: null,
    },
  ];

  // Filter students based on search and status
  const filteredStudents = studentsData.filter(student => {
    const matchesSearch = student.name.toLowerCase().includes(searchText.toLowerCase()) ||
                         student.rollNumber.toLowerCase().includes(searchText.toLowerCase());
    
    const matchesFilter = filterStatus === 'all' || 
                         (filterStatus === 'uploaded' && student.pedStatus === 'uploaded') ||
                         (filterStatus === 'not-uploaded' && student.pedStatus === 'not-uploaded');
    
    return matchesSearch && matchesFilter;
  });

  // Calculate stats
  const totalStudents = studentsData.length;
  const uploadedCount = studentsData.filter(s => s.pedStatus === 'uploaded').length;
  const certificateCount = studentsData.filter(s => s.certificateStatus === 'generated').length;

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'uploaded':
      case 'generated':
        return '#4CAF50';
      case 'not-uploaded':
      case 'not-generated':
        return '#FF5722';
      default:
        return '#666';
    }
  };

  const getStatusText = (status: string) => {
    switch (status) {
      case 'uploaded':
        return 'рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛';
      case 'not-uploaded':
        return 'рдЕрдкрд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛';
      case 'generated':
        return 'рдЬреЗрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛';
      case 'not-generated':
        return 'рдЬреЗрдирд░реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛';
      default:
        return status;
    }
  };

  const handleStudentAction = (student: any) => {
    Alert.alert(
      `${student.name} рдХреА рдЬрд╛рдирдХрд╛рд░реА`,
      `рд░реЛрд▓ рдирдВрдмрд░: ${student.rollNumber}\nUDISE рдХреЛрдб: ${student.udiseCode}\nрдкреЗрдбрд╝ рд╕реНрдерд┐рддрд┐: ${getStatusText(student.pedStatus)}\nрдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд┐рддрд┐: ${getStatusText(student.certificateStatus)}${student.uploadDate ? `\nрдЕрдкрд▓реЛрдб рджрд┐рдирд╛рдВрдХ: ${student.uploadDate}` : ''}`,
      [
        { text: 'рдмрдВрдж рдХрд░реЗрдВ', style: 'cancel' },
        student.pedStatus === 'not-uploaded' && {
          text: 'рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ',
          onPress: () => Alert.alert('рд╕реБрд╡рд┐рдзрд╛', 'рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рд╕реБрд╡рд┐рдзрд╛ рдЬрд▓реНрджреА рдЖрдПрдЧреА!'),
        },
        student.pedStatus === 'uploaded' && student.certificateStatus === 'not-generated' && {
          text: 'рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рдПрдВ',
          onPress: () => Alert.alert('рд╕реБрд╡рд┐рдзрд╛', 'рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдмрдирд╛рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдЬрд▓реНрджреА рдЖрдПрдЧреА!'),
        },
      ].filter(Boolean) as any[]
    );
  };

  const renderStudentCard = (student: any) => {
    return (
      <TouchableOpacity 
        key={student.id} 
        style={styles.studentCard}
        onPress={() => handleStudentAction(student)}
      >
        <View style={styles.cardHeader}>
          <View style={styles.studentInfo}>
            <Text style={styles.studentName}>{student.name}</Text>
            <Text style={styles.rollNumber}>рд░реЛрд▓ рдирдВрдмрд░: {student.rollNumber}</Text>
          </View>
          <View style={styles.idContainer}>
            <Text style={styles.studentId}>#{student.id}</Text>
          </View>
        </View>
        
        <View style={styles.cardBody}>
          <View style={styles.infoRow}>
            <Text style={styles.infoLabel}>UDISE рдХреЛрдб:</Text>
            <Text style={styles.infoValue}>{student.udiseCode}</Text>
          </View>
          
          <View style={styles.statusRow}>
            <View style={styles.statusItem}>
              <Text style={styles.statusLabel}>рдкреЗрдбрд╝ рд╕реНрдерд┐рддрд┐:</Text>
              <View style={[styles.statusBadge, { backgroundColor: getStatusColor(student.pedStatus) }]}>
                <Text style={styles.statusText}>
                  {student.pedStatus === 'uploaded' ? 'тЬЕ рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛' : 'тЭМ рдЕрдкрд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛'}
                </Text>
              </View>
            </View>
          </View>
          
          <View style={styles.statusRow}>
            <View style={styles.statusItem}>
              <Text style={styles.statusLabel}>рдкреНрд░рдорд╛рдгрдкрддреНрд░ рд╕реНрдерд┐рддрд┐:</Text>
              <View style={[styles.statusBadge, { backgroundColor: getStatusColor(student.certificateStatus) }]}>
                <Text style={styles.statusText}>
                  {student.certificateStatus === 'generated' ? 'ЁЯПЖ рдЬреЗрдирд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛' : 'тП│ рдЬреЗрдирд░реЗрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛'}
                </Text>
              </View>
            </View>
          </View>
          
          {student.uploadDate && (
            <View style={styles.infoRow}>
              <Text style={styles.infoLabel}>рдЕрдкрд▓реЛрдб рджрд┐рдирд╛рдВрдХ:</Text>
              <Text style={styles.infoValue}>{student.uploadDate}</Text>
            </View>
          )}
        </View>
        
        <TouchableOpacity style={styles.actionButton}>
          <Text style={styles.actionButtonText}>ЁЯУЛ рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ</Text>
        </TouchableOpacity>
      </TouchableOpacity>
    );
  };

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView showsVerticalScrollIndicator={false}>
        {/* Header */}
        <View style={styles.header}>
          <TouchableOpacity style={styles.backButton} onPress={onBack}>
            <Text style={styles.backButtonText}>тЖР рд╡рд╛рдкрд╕</Text>
          </TouchableOpacity>
          
          <View style={styles.titleSection}>
            <Text style={styles.title}>ЁЯСе рдЫрд╛рддреНрд░ рдбреЗрдЯрд╛</Text>
            <Text style={styles.subtitle}>рдПрдХ рдкреЗрдбрд╝ рдорд╛рдБ рдХреЗ рдирд╛рдо 2.0</Text>
          </View>
          
          <View style={styles.statsContainer}>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{totalStudents}</Text>
              <Text style={styles.statLabel}>рдХреБрд▓ рдЫрд╛рддреНрд░</Text>
            </View>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{uploadedCount}</Text>
              <Text style={styles.statLabel}>рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛</Text>
            </View>
            <View style={styles.statItem}>
              <Text style={styles.statNumber}>{certificateCount}</Text>
              <Text style={styles.statLabel}>рдкреНрд░рдорд╛рдгрдкрддреНрд░</Text>
            </View>
          </View>
        </View>

        {/* Search and Filter */}
        <View style={styles.searchSection}>
          <View style={styles.searchContainer}>
            <Text style={styles.searchIcon}>ЁЯФН</Text>
            <TextInput
              style={styles.searchInput}
              placeholder="рдЫрд╛рддреНрд░ рдХрд╛ рдирд╛рдо рдпрд╛ рд░реЛрд▓ рдирдВрдмрд░ рдЦреЛрдЬреЗрдВ..."
              placeholderTextColor="#999"
              value={searchText}
              onChangeText={setSearchText}
            />
          </View>
          
          <View style={styles.filterContainer}>
            <Text style={styles.filterTitle}>рдлрд╝рд┐рд▓реНрдЯрд░:</Text>
            <ScrollView horizontal showsHorizontalScrollIndicator={false}>
              <TouchableOpacity 
                style={[styles.filterButton, filterStatus === 'all' && styles.activeFilter]}
                onPress={() => setFilterStatus('all')}
              >
                <Text style={[styles.filterText, filterStatus === 'all' && styles.activeFilterText]}>
                  рд╕рднреА
                </Text>
              </TouchableOpacity>
              <TouchableOpacity 
                style={[styles.filterButton, filterStatus === 'uploaded' && styles.activeFilter]}
                onPress={() => setFilterStatus('uploaded')}
              >
                <Text style={[styles.filterText, filterStatus === 'uploaded' && styles.activeFilterText]}>
                  рдЕрдкрд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛
                </Text>
              </TouchableOpacity>
              <TouchableOpacity 
                style={[styles.filterButton, filterStatus === 'not-uploaded' && styles.activeFilter]}
                onPress={() => setFilterStatus('not-uploaded')}
              >
                <Text style={[styles.filterText, filterStatus === 'not-uploaded' && styles.activeFilterText]}>
                  рдЕрдкрд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛
                </Text>
              </TouchableOpacity>
            </ScrollView>
          </View>
        </View>

        {/* Students List */}
        <View style={styles.studentsContainer}>
          <Text style={styles.resultsCount}>
            {filteredStudents.length} рдЫрд╛рддреНрд░ рдорд┐рд▓реЗ
          </Text>
          
          {filteredStudents.map(renderStudentCard)}
        </View>

        <View style={styles.bottomSpace} />
      </ScrollView>
    </SafeAreaView>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#E8F5E8',
  },
  header: {
    backgroundColor: '#2196F3',
    paddingHorizontal: 20,
    paddingTop: 20,
    paddingBottom: 30,
    borderBottomLeftRadius: 25,
    borderBottomRightRadius: 25,
  },
  backButton: {
    alignSelf: 'flex-start',
    paddingHorizontal: 12,
    paddingVertical: 8,
    borderRadius: 20,
    backgroundColor: 'rgba(255, 255, 255, 0.2)',
    marginBottom: 15,
  },
  backButtonText: {
    color: 'white',
    fontSize: 14,
    fontWeight: 'bold',
  },
  titleSection: {
    alignItems: 'center',
    marginBottom: 20,
  },
  title: {
    fontSize: 24,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 5,
  },
  subtitle: {
    fontSize: 16,
    color: 'white',
    opacity: 0.9,
  },
  statsContainer: {
    flexDirection: 'row',
    justifyContent: 'space-around',
  },
  statItem: {
    alignItems: 'center',
    backgroundColor: 'rgba(255, 255, 255, 0.2)',
    paddingHorizontal: 15,
    paddingVertical: 10,
    borderRadius: 15,
    minWidth: 80,
  },
  statNumber: {
    fontSize: 20,
    fontWeight: 'bold',
    color: 'white',
  },
  statLabel: {
    fontSize: 11,
    color: 'white',
    opacity: 0.9,
  },
  searchSection: {
    paddingHorizontal: 20,
    paddingVertical: 20,
  },
  searchContainer: {
    flexDirection: 'row',
    alignItems: 'center',
    backgroundColor: 'white',
    borderRadius: 15,
    paddingHorizontal: 15,
    paddingVertical: 12,
    marginBottom: 15,
    elevation: 2,
  },
  searchIcon: {
    fontSize: 18,
    marginRight: 10,
  },
  searchInput: {
    flex: 1,
    fontSize: 16,
    color: '#333',
  },
  filterContainer: {
    flexDirection: 'row',
    alignItems: 'center',
  },
  filterTitle: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginRight: 10,
  },
  filterButton: {
    backgroundColor: 'white',
    paddingHorizontal: 12,
    paddingVertical: 6,
    borderRadius: 15,
    marginRight: 8,
    borderWidth: 1,
    borderColor: '#C8E6C9',
  },
  activeFilter: {
    backgroundColor: '#2196F3',
    borderColor: '#2196F3',
  },
  filterText: {
    color: '#2196F3',
    fontSize: 12,
    fontWeight: 'bold',
  },
  activeFilterText: {
    color: 'white',
  },
  studentsContainer: {
    paddingHorizontal: 20,
  },
  resultsCount: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 15,
  },
  studentCard: {
    backgroundColor: 'white',
    borderRadius: 15,
    marginBottom: 15,
    elevation: 3,
    overflow: 'hidden',
  },
  cardHeader: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
    backgroundColor: '#F1F8E9',
    padding: 15,
  },
  studentInfo: {
    flex: 1,
  },
  studentName: {
    fontSize: 18,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 3,
  },
  rollNumber: {
    fontSize: 14,
    color: '#666',
  },
  idContainer: {
    backgroundColor: '#E8F5E8',
    paddingHorizontal: 10,
    paddingVertical: 5,
    borderRadius: 10,
  },
  studentId: {
    fontSize: 12,
    color: '#4CAF50',
    fontWeight: 'bold',
  },
  cardBody: {
    padding: 15,
  },
  infoRow: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 8,
  },
  infoLabel: {
    fontSize: 14,
    color: '#666',
  },
  infoValue: {
    fontSize: 14,
    fontWeight: 'bold',
    color: '#333',
  },
  statusRow: {
    marginBottom: 10,
  },
  statusItem: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  statusLabel: {
    fontSize: 14,
    color: '#666',
  },
  statusBadge: {
    paddingHorizontal: 10,
    paddingVertical: 5,
    borderRadius: 15,
  },
  statusText: {
    color: 'white',
    fontSize: 12,
    fontWeight: 'bold',
  },
  actionButton: {
    backgroundColor: '#2196F3',
    paddingVertical: 12,
    alignItems: 'center',
    borderBottomLeftRadius: 15,
    borderBottomRightRadius: 15,
  },
  actionButtonText: {
    color: 'white',
    fontSize: 14,
    fontWeight: 'bold',
  },
  bottomSpace: {
    height: 20,
  },
});

export default StudentsDataScreen;
