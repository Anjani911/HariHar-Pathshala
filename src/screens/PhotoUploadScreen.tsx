import React, { useState } from 'react';
import {
  View,
  Text,
  TouchableOpacity,
  StyleSheet,
  ScrollView,
  Alert,
  Dimensions,
  Image,
} from 'react-native';

const { width } = Dimensions.get('window');

const PhotoUploadScreen = () => {
  const [selectedPhotos, setSelectedPhotos] = useState({
    student: null,
    tree: null,
    teacher: null,
  });

  const [uploadStats, setUploadStats] = useState({
    total: 145,
    uploaded: 89,
    pending: 56,
  });

  const photoTypes = [
    {
      key: 'student',
      title: 'рдЫрд╛рддреНрд░ рдХреА рдлреЛрдЯреЛ',
      emoji: 'ЁЯСитАНЁЯОУ',
      description: 'рдкреЗрдбрд╝ рдХреЗ рд╕рд╛рде рдЫрд╛рддреНрд░ рдХреА рд╕реНрдкрд╖реНрдЯ рдлреЛрдЯреЛ',
      color: '#2E7D32',
      required: true,
    },
    {
      key: 'tree',
      title: 'рдкреЗрдбрд╝ рдХреА рдлреЛрдЯреЛ',
      emoji: 'ЁЯМ│',
      description: 'рд▓рдЧрд╛рдП рдЧрдП рдкреЗрдбрд╝ рдХреА рд╕реНрдкрд╖реНрдЯ рдлреЛрдЯреЛ',
      color: '#4CAF50',
      required: true,
    },
    {
      key: 'teacher',
      title: 'рд╢рд┐рдХреНрд╖рдХ рдХреА рдлреЛрдЯреЛ',
      emoji: 'ЁЯСитАНЁЯПл',
      description: 'рдкреЗрдбрд╝ рдХреЗ рд╕рд╛рде рд╢рд┐рдХреНрд╖рдХ рдХреА рдлреЛрдЯреЛ',
      color: '#66BB6A',
      required: true,
    },
  ];

  const handlePhotoSelect = (type: string) => {
    Alert.alert(
      'рдлреЛрдЯреЛ рдЪреБрдиреЗрдВ',
      'рдЖрдк рдХреИрдорд░рд╛ рдпрд╛ рдЧреИрд▓рд░реА рд╕реЗ рдлреЛрдЯреЛ рдЪреБрди рд╕рдХрддреЗ рд╣реИрдВ',
      [
        {
          text: 'рдХреИрдорд░рд╛ рд╕реЗ рд▓реЗрдВ',
          onPress: () => openCamera(type),
        },
        {
          text: 'рдЧреИрд▓рд░реА рд╕реЗ рдЪреБрдиреЗрдВ',
          onPress: () => openGallery(type),
        },
        { text: 'рд░рджреНрдж рдХрд░реЗрдВ', style: 'cancel' },
      ]
    );
  };

  const openCamera = (type: string) => {
    // Placeholder for camera functionality
    Alert.alert('рдХреИрдорд░рд╛', `${type} рдХреЗ рд▓рд┐рдП рдХреИрдорд░рд╛ рдЦреБрд▓ рд░рд╣рд╛ рд╣реИ...`);
    // Here you would use expo-image-picker to open camera
    setSelectedPhotos(prev => ({
      ...prev,
      [type]: `camera_photo_${type}.jpg`,
    }));
  };

  const openGallery = (type: string) => {
    // Placeholder for gallery functionality
    Alert.alert('рдЧреИрд▓рд░реА', `${type} рдХреЗ рд▓рд┐рдП рдЧреИрд▓рд░реА рдЦреБрд▓ рд░рд╣рд╛ рд╣реИ...`);
    // Here you would use expo-image-picker to open gallery
    setSelectedPhotos(prev => ({
      ...prev,
      [type]: `gallery_photo_${type}.jpg`,
    }));
  };

  const handleUpload = () => {
    const { student, tree, teacher } = selectedPhotos;
    
    if (!student || !tree || !teacher) {
      Alert.alert('рддреНрд░реБрдЯрд┐', 'рдХреГрдкрдпрд╛ рд╕рднреА рддреАрди рдлреЛрдЯреЛ рдЪреБрдиреЗрдВ (рдЫрд╛рддреНрд░, рдкреЗрдбрд╝, рд╢рд┐рдХреНрд╖рдХ)');
      return;
    }

    Alert.alert(
      'рдЕрдкрд▓реЛрдб рдкреБрд╖реНрдЯрд┐',
      'рдХреНрдпрд╛ рдЖрдк рд╕рднреА рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?',
      [
        {
          text: 'рд╣рд╛рдБ, рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ',
          onPress: () => {
            Alert.alert('рд╕рдлрд▓!', 'рд╕рднреА рдлреЛрдЯреЛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЕрдкрд▓реЛрдб рд╣реЛ рдЧрдИ рд╣реИрдВ');
            setUploadStats(prev => ({
              ...prev,
              uploaded: prev.uploaded + 1,
              pending: prev.pending - 1,
            }));
          },
        },
        { text: 'рд░рджреНрдж рдХрд░реЗрдВ', style: 'cancel' },
      ]
    );
  };

  const clearPhoto = (type: string) => {
    setSelectedPhotos(prev => ({
      ...prev,
      [type]: null,
    }));
  };

  return (
    <View style={styles.container}>
      <View style={styles.header}>
        <Text style={styles.headerTitle}>ЁЯУ╕ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб</Text>
        <Text style={styles.headerSubtitle}>рдЫрд╛рддреНрд░-рдкреЗрдбрд╝-рд╢рд┐рдХреНрд╖рдХ рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ</Text>
      </View>

      <ScrollView style={styles.content} showsVerticalScrollIndicator={false}>
        {/* Upload Stats */}
        <View style={styles.statsContainer}>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{uploadStats.total}</Text>
            <Text style={styles.statLabel}>рдХреБрд▓ рдЫрд╛рддреНрд░</Text>
          </View>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{uploadStats.uploaded}</Text>
            <Text style={styles.statLabel}>рдЕрдкрд▓реЛрдб рд╣реЛ рдЧрдП</Text>
          </View>
          <View style={styles.statCard}>
            <Text style={styles.statNumber}>{uploadStats.pending}</Text>
            <Text style={styles.statLabel}>рдмрд╛рдХреА рд╣реИрдВ</Text>
          </View>
        </View>

        {/* Progress Bar */}
        <View style={styles.progressContainer}>
          <View style={styles.progressBar}>
            <View 
              style={[
                styles.progressFill, 
                { width: `${(uploadStats.uploaded / uploadStats.total) * 100}%` }
              ]} 
            />
          </View>
          <Text style={styles.progressText}>
            рдкреНрд░рдЧрддрд┐: {Math.round((uploadStats.uploaded / uploadStats.total) * 100)}%
          </Text>
        </View>

        {/* Instructions */}
        <View style={styles.instructionCard}>
          <Text style={styles.instructionTitle}>ЁЯУЛ рдирд┐рд░реНрджреЗрд╢</Text>
          <Text style={styles.instructionText}>
            тАв рддреАрдиреЛрдВ рдлреЛрдЯреЛ рдЕрдЪреНрдЫреА рдЧреБрдгрд╡рддреНрддрд╛ рдореЗрдВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП{'\n'}
            тАв рдЫрд╛рддреНрд░ рдФрд░ рд╢рд┐рдХреНрд╖рдХ рдкреЗрдбрд╝ рдХреЗ рд╕рд╛рде рджрд┐рдЦрдиреЗ рдЪрд╛рд╣рд┐рдП{'\n'}
            тАв рдлреЛрдЯреЛ рдореЗрдВ рдЪреЗрд╣рд░рд╛ рд╕реНрдкрд╖реНрдЯ рджрд┐рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП{'\n'}
            тАв рдкреЗрдбрд╝ рдХреА рдлреЛрдЯреЛ рдЕрд▓рдЧ рд╕реЗ рднреА рд▓реЗрдВ
          </Text>
        </View>

        {/* Photo Upload Cards */}
        {photoTypes.map((photo) => (
          <View key={photo.key} style={styles.photoCard}>
            <View style={styles.photoHeader}>
              <Text style={styles.photoEmoji}>{photo.emoji}</Text>
              <View style={styles.photoTitleContainer}>
                <Text style={styles.photoTitle}>{photo.title}</Text>
                <Text style={styles.photoDescription}>{photo.description}</Text>
                {photo.required && <Text style={styles.requiredText}>* рдЖрд╡рд╢реНрдпрдХ</Text>}
              </View>
            </View>

            {selectedPhotos[photo.key as keyof typeof selectedPhotos] ? (
              <View style={styles.selectedPhotoContainer}>
                <View style={styles.photoPreview}>
                  <Text style={styles.photoPreviewText}>ЁЯУ╖</Text>
                  <Text style={styles.selectedText}>рдлреЛрдЯреЛ рдЪреБрдиреА рдЧрдИ</Text>
                </View>
                <View style={styles.photoActions}>
                  <TouchableOpacity 
                    style={styles.changeButton}
                    onPress={() => handlePhotoSelect(photo.key)}
                  >
                    <Text style={styles.changeButtonText}>рдмрджрд▓реЗрдВ</Text>
                  </TouchableOpacity>
                  <TouchableOpacity 
                    style={styles.removeButton}
                    onPress={() => clearPhoto(photo.key)}
                  >
                    <Text style={styles.removeButtonText}>рд╣рдЯрд╛рдПрдВ</Text>
                  </TouchableOpacity>
                </View>
              </View>
            ) : (
              <TouchableOpacity 
                style={[styles.uploadButton, { backgroundColor: photo.color }]}
                onPress={() => handlePhotoSelect(photo.key)}
              >
                <Text style={styles.uploadButtonText}>ЁЯУ╖ рдлреЛрдЯреЛ рдЪреБрдиреЗрдВ</Text>
              </TouchableOpacity>
            )}
          </View>
        ))}

        {/* Upload Button */}
        <TouchableOpacity style={styles.submitButton} onPress={handleUpload}>
          <Text style={styles.submitButtonText}>ЁЯЪА рд╕рднреА рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ</Text>
        </TouchableOpacity>

        {/* Help Section */}
        <View style={styles.helpSection}>
          <Text style={styles.helpTitle}>рд╕рдорд╕реНрдпрд╛?</Text>
          <TouchableOpacity 
            style={styles.helpButton}
            onPress={() => Alert.alert('рд╡реАрдбрд┐рдпреЛ рдЧрд╛рдЗрдб', 'рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рд╡реАрдбрд┐рдпреЛ рдЧрд╛рдЗрдб рджреЗрдЦреЗрдВ')}
          >
            <Text style={styles.helpEmoji}>ЁЯОе</Text>
            <Text style={styles.helpText}>рдлреЛрдЯреЛ рдЕрдкрд▓реЛрдб рдЧрд╛рдЗрдб рджреЗрдЦреЗрдВ</Text>
          </TouchableOpacity>
          
          <TouchableOpacity 
            style={styles.helpButton}
            onPress={() => Alert.alert('рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛', 'рдорджрдж рдХреЗ рд▓рд┐рдП рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ: 9876543210')}
          >
            <Text style={styles.helpEmoji}>ЁЯУЮ</Text>
            <Text style={styles.helpText}>рддрдХрдиреАрдХреА рд╕рд╣рд╛рдпрддрд╛</Text>
          </TouchableOpacity>
        </View>
      </ScrollView>
    </View>
  );
};

const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#E8F5E8',
  },
  header: {
    backgroundColor: '#2E7D32',
    paddingTop: 60,
    paddingBottom: 24,
    paddingHorizontal: 20,
    alignItems: 'center',
  },
  headerTitle: {
    fontSize: 24,
    fontWeight: 'bold',
    color: 'white',
    marginBottom: 4,
  },
  headerSubtitle: {
    fontSize: 16,
    color: 'white',
    opacity: 0.9,
  },
  content: {
    flex: 1,
    padding: 16,
  },
  statsContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    marginBottom: 20,
  },
  statCard: {
    backgroundColor: 'white',
    padding: 16,
    borderRadius: 12,
    alignItems: 'center',
    flex: 1,
    marginHorizontal: 4,
    elevation: 2,
  },
  statNumber: {
    fontSize: 24,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 4,
  },
  statLabel: {
    fontSize: 12,
    color: '#4CAF50',
    textAlign: 'center',
  },
  progressContainer: {
    backgroundColor: 'white',
    padding: 16,
    borderRadius: 12,
    marginBottom: 20,
    elevation: 2,
  },
  progressBar: {
    height: 8,
    backgroundColor: '#E0E0E0',
    borderRadius: 4,
    marginBottom: 8,
    overflow: 'hidden',
  },
  progressFill: {
    height: '100%',
    backgroundColor: '#4CAF50',
    borderRadius: 4,
  },
  progressText: {
    fontSize: 14,
    color: '#2E7D32',
    fontWeight: '600',
    textAlign: 'center',
  },
  instructionCard: {
    backgroundColor: 'white',
    padding: 16,
    borderRadius: 12,
    marginBottom: 20,
    elevation: 2,
  },
  instructionTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 8,
  },
  instructionText: {
    fontSize: 14,
    color: '#4CAF50',
    lineHeight: 20,
  },
  photoCard: {
    backgroundColor: 'white',
    padding: 16,
    borderRadius: 12,
    marginBottom: 16,
    elevation: 2,
  },
  photoHeader: {
    flexDirection: 'row',
    alignItems: 'center',
    marginBottom: 16,
  },
  photoEmoji: {
    fontSize: 32,
    marginRight: 12,
  },
  photoTitleContainer: {
    flex: 1,
  },
  photoTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 4,
  },
  photoDescription: {
    fontSize: 12,
    color: '#4CAF50',
    marginBottom: 2,
  },
  requiredText: {
    fontSize: 11,
    color: '#FF5722',
    fontWeight: '600',
  },
  selectedPhotoContainer: {
    flexDirection: 'row',
    justifyContent: 'space-between',
    alignItems: 'center',
  },
  photoPreview: {
    flexDirection: 'row',
    alignItems: 'center',
    flex: 1,
  },
  photoPreviewText: {
    fontSize: 24,
    marginRight: 8,
  },
  selectedText: {
    fontSize: 14,
    color: '#4CAF50',
    fontWeight: '600',
  },
  photoActions: {
    flexDirection: 'row',
  },
  changeButton: {
    backgroundColor: '#2E7D32',
    paddingHorizontal: 16,
    paddingVertical: 8,
    borderRadius: 8,
    marginRight: 8,
  },
  changeButtonText: {
    color: 'white',
    fontSize: 12,
    fontWeight: '600',
  },
  removeButton: {
    backgroundColor: '#F44336',
    paddingHorizontal: 16,
    paddingVertical: 8,
    borderRadius: 8,
  },
  removeButtonText: {
    color: 'white',
    fontSize: 12,
    fontWeight: '600',
  },
  uploadButton: {
    padding: 16,
    borderRadius: 12,
    alignItems: 'center',
  },
  uploadButtonText: {
    color: 'white',
    fontSize: 16,
    fontWeight: 'bold',
  },
  submitButton: {
    backgroundColor: '#2E7D32',
    padding: 18,
    borderRadius: 12,
    alignItems: 'center',
    marginVertical: 20,
    elevation: 4,
  },
  submitButtonText: {
    color: 'white',
    fontSize: 18,
    fontWeight: 'bold',
  },
  helpSection: {
    backgroundColor: 'white',
    padding: 16,
    borderRadius: 12,
    marginBottom: 20,
    elevation: 2,
  },
  helpTitle: {
    fontSize: 16,
    fontWeight: 'bold',
    color: '#2E7D32',
    marginBottom: 12,
  },
  helpButton: {
    flexDirection: 'row',
    alignItems: 'center',
    paddingVertical: 12,
    paddingHorizontal: 12,
    backgroundColor: '#E8F5E8',
    borderRadius: 8,
    marginBottom: 8,
  },
  helpEmoji: {
    fontSize: 20,
    marginRight: 12,
  },
  helpText: {
    fontSize: 14,
    color: '#2E7D32',
  },
});

export default PhotoUploadScreen;
